<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Michael D. Sumner" />

<meta name="date" content="2017-08-05" />

<title>Tabularaster</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Tabularaster</h1>
<h4 class="author"><em>Michael D. Sumner</em></h4>
<h4 class="date"><em>2017-08-05</em></h4>



<div id="tabularaster" class="section level1">
<h1>tabularaster</h1>
<p>The <code>raster</code> package is extremely powerful in the R ecosystem for spatial data. It can be used very efficiently to drive data extraction and summary tools using its consistent cell-index and comprehensive helper functions for converting between cell values and less abstract raster grid properties.</p>
<p>Tabularaster provides some more helpers for working with cells and tries to fill some of the (very few!) gaps in raster functionality. When raster returns cell values of hierarchical objects it returns a hierarchical (list) of cells to match the input query.</p>
<p>Tabularaster provides:</p>
<ul>
<li>extraction of cells as a simple data frame with “object ID” and “cell index”</li>
<li><code>as_tibble</code> for raster data, with options for value column and cell, dimension and date indexing</li>
<li>workers to bring <code>sf</code> support to <code>raster</code></li>
</ul>
<p>Extract the cell numbers of raster <code>r</code> that are co-located with object <code>q</code>. (The argument names are <code>x</code> and <code>query</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cellnumbers</span>(r, q)</code></pre></div>
<p>In the above example, <code>r</code> is any <em>raster</em> object and <code>q</code> is another spatial object, used as a query. Cell numbers can be extracted from any raster object, any of a <code>raster::raster</code>, <code>raster::stack</code> or <code>raster::brick</code>. It’s not really relevant what that object contains, as only the <em>dimensions</em> (number of cells in x and y) and the <em>extent</em> (geographic range in x and y) determine the result. The <code>r</code> object can actually not contain any data - this is a very powerful but seemingly under-used feature of the <code>raster</code> package.</p>
<p>The object <code>q</code> may be any of <code>sf</code>, <code>sp</code> layer types or a matrix of raw coordinates (x-y). (‘Exotic’ <code>sf</code> types like GEOMETRYCOLLECTION or POLYHEDRALSURFACE, and mixed-topology layers are not yet supported - let me know if you really need this and we’ll make it work.)</p>
<p>Tabularaster follows the basic principles of tidy data and <em>hypertidy data</em> and aspires to keep the software design out of your way and simply help to get the task done.</p>
</div>
<div id="simple-examples" class="section level1">
<h1>Simple examples</h1>
<p>In straightforward usage, <code>cellnumbers</code> returns a tibble with <code>object_</code> to identify the spatial object by number, and <code>cell_</code> which is specific to the raster object, a function of its <code>extent</code>, <code>dim</code>ensions and <code>projection</code> (crs - coordinate reference system).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raster)</code></pre></div>
<pre><code>## Loading required package: sp</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tabularaster)
(r &lt;-<span class="st"> </span><span class="kw">raster</span>(volcano))</code></pre></div>
<pre><code>## class       : RasterLayer 
## dimensions  : 87, 61, 5307  (nrow, ncol, ncell)
## resolution  : 0.01639344, 0.01149425  (x, y)
## extent      : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)
## coord. ref. : NA 
## data source : in memory
## names       : layer 
## values      : 94, 195  (min, max)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(cell &lt;-<span class="st"> </span><span class="kw">cellnumbers</span>(r, <span class="kw">cbind</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>)))</code></pre></div>
<pre><code>## Warning: projections not the same 
##     x: NA
## query: NA</code></pre>
<pre><code>## # A tibble: 1 x 2
##   object_ cell_
##     &lt;int&gt; &lt;dbl&gt;
## 1       1  2654</code></pre>
<p>This cell number query can be then be used to drive other raster functions, like <code>extract</code> and <code>xyFromCell</code> and many others.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">xyFromCell</span>(r, cell<span class="op">$</span>cell_)</code></pre></div>
<pre><code>##        x   y
## [1,] 0.5 0.5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">raster<span class="op">::</span><span class="kw">extract</span>(r, cell<span class="op">$</span>cell_)</code></pre></div>
<pre><code>##     
## 161</code></pre>
<p>This is an extremely efficient way to drive extractions from raster objects, for performing the same query from multiple layers at different times. It’s also very useful for using <code>dplyr</code> to derive summaries, rather than juggling lists of extracted values, or different parts of raster objects.</p>
<div id="as-tibble" class="section level2">
<h2>as tibble</h2>
<p>There is an <code>as_tibble</code> method with options for cell, dimension, and date.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)</code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:raster':
## 
##     intersect, select, union</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as_tibble</span>(r)</code></pre></div>
<pre><code>## # A tibble: 5,307 x 2
##    cellvalue cellindex
##        &lt;dbl&gt;     &lt;int&gt;
##  1       100         1
##  2       100         2
##  3       101         3
##  4       101         4
##  5       101         5
##  6       101         6
##  7       101         7
##  8       100         8
##  9       100         9
## 10       100        10
## # ... with 5,297 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b &lt;-<span class="st"> </span><span class="kw">brick</span>(r, r<span class="op">*</span><span class="dv">2</span>)
<span class="kw">as_tibble</span>(b)</code></pre></div>
<pre><code>## # A tibble: 10,614 x 3
##    cellvalue cellindex dimindex
##        &lt;dbl&gt;     &lt;int&gt;    &lt;int&gt;
##  1       100         1        1
##  2       100         2        1
##  3       101         3        1
##  4       101         4        1
##  5       101         5        1
##  6       101         6        1
##  7       101         7        1
##  8       100         8        1
##  9       100         9        1
## 10       100        10        1
## # ... with 10,604 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as_tibble</span>(b, <span class="dt">cell =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(dimindex)) ## leave out the cell index</code></pre></div>
<pre><code>## # A tibble: 10,614 x 2
##    cellvalue dimindex
##        &lt;dbl&gt;    &lt;int&gt;
##  1       200        2
##  2       200        2
##  3       202        2
##  4       202        2
##  5       202        2
##  6       202        2
##  7       202        2
##  8       200        2
##  9       200        2
## 10       200        2
## # ... with 10,604 more rows</code></pre>
<p>The date or date-time is used as the dimension index if present.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">btime &lt;-<span class="st"> </span><span class="kw">setZ</span>(b, <span class="kw">Sys.time</span>() <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">10</span>))
<span class="kw">as_tibble</span>(btime) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(dimindex) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>())</code></pre></div>
<pre><code>## # A tibble: 2 x 2
##              dimindex     n
##                &lt;dttm&gt; &lt;int&gt;
## 1 2017-08-05 14:03:46  5307
## 2 2017-08-05 14:03:55  5307</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as_tibble</span>(btime, <span class="dt">split_date =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 10,614 x 5
##    cellvalue cellindex  year month   day
##        &lt;dbl&gt;     &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1       100         1  2017     8     5
##  2       100         2  2017     8     5
##  3       101         3  2017     8     5
##  4       101         4  2017     8     5
##  5       101         5  2017     8     5
##  6       101         6  2017     8     5
##  7       101         7  2017     8     5
##  8       100         8  2017     8     5
##  9       100         9  2017     8     5
## 10       100        10  2017     8     5
## # ... with 10,604 more rows</code></pre>
</div>
</div>
<div id="warnings" class="section level1">
<h1>Warnings</h1>
<ol style="list-style-type: decimal">
<li>I tend to end up using <code>tidyr::extract</code> and <code>raster::extract</code>, <code>dplyr::select</code> and <code>raster::select</code> as I always use these packages together.</li>
<li><code>cellnumbers</code> doesn’t currently reproject the second argument <code>query</code>, even when would make sense to do so like <code>extract</code> does. This is purely to reduce the required dependencies.</li>
<li>There’s no formal link between the cell number values and the raster object itself. I use this “loose coupling” so extensively that I have developed habits that tend to make it pretty robust. Please use with caution, you can easily get incorrect answers by asking a different raster a question based on the wrong cell numbers.</li>
</ol>
<p>If you find that things don’t work, first check if it’s a namespace problem, there are a few function name overlaps in the <code>tidyverse</code> and <code>raster</code>, and in R generally. There is no way to fix this properly atm.</p>
<p>Tabularaster doesn’t reproject on the fly, but it will tell you if the CRS (projection metadata) of the two objects is not the same, or if either or both are NA. I’d like a light-weight reprojection engine in order to do this, and <code>proj4</code> is a candidate that I’ve explored enough to use but a modern, trim PROJ.4 interface for R in its own package is something I think we need.</p>
<p>Ultimately the cell index vector should probably be a formal class, with knowledge of its extent and grain. I’d love this to be formalized, but I seem to not have the design expertise required to get the system right. It’s something that <code>ggplot2</code> needs, but there aren’t any existing examples in R anywhere as far as I can tell. The <a href="https://github.com/edzer/stars">stars project</a> is a good place to see what else is happening in this space in R. Other examples are the unfinshed <code>tbl_cube</code> in <code>dplyr</code>, the R6 objects in <code>velox</code>, and the mesh indexing used by packages <code>rgl</code>, <code>Vcg</code>, <code>icosa</code>, <code>dggridR</code>, <code>deldir</code>, <code>geometry</code>, <code>RTriangle</code>, <code>TBA</code>, (and there are many others).</p>
<p>If you are interested in these issues please get in touch, use the <a href="https://github.com/hypertidy/tabularaster/issues">Issues tab</a> or <a href="https://github.com/r-spatial/discuss">discuss at r-spatial</a>, get on <a href="https://twitter.com/hashtag/rstats">twitter #rstats</a> or contact me directly.</p>
</div>
<div id="applied-example" class="section level1">
<h1>Applied example</h1>
<p>This example uses extracted data per polygon and uses base R to <code>lapply</code> across the list of values extracted per polygon. Here we show a more <code>dplyrish</code> version after extracting the cell numbers with <code>tabularaster</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tabularaster)
## https://gis.stackexchange.com/questions/102870/step-by-step-how-do-i-extract-raster-values-from-polygon-overlay-with-q-gis-or

<span class="kw">library</span>(raster)

<span class="co"># Create integer class raster</span>
r &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="dt">ncol=</span><span class="dv">36</span>, <span class="dt">nrow=</span><span class="dv">18</span>)
r[] &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">runif</span>(<span class="kw">ncell</span>(r),<span class="dv">1</span>,<span class="dv">10</span>),<span class="dt">digits=</span><span class="dv">0</span>)

<span class="co"># Create two polygons</span>
cds1 &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">180</span>,<span class="op">-</span><span class="dv">20</span>), <span class="kw">c</span>(<span class="op">-</span><span class="dv">160</span>,<span class="dv">5</span>), <span class="kw">c</span>(<span class="op">-</span><span class="dv">60</span>, <span class="dv">0</span>), <span class="kw">c</span>(<span class="op">-</span><span class="dv">160</span>,<span class="op">-</span><span class="dv">60</span>), <span class="kw">c</span>(<span class="op">-</span><span class="dv">180</span>,<span class="op">-</span><span class="dv">20</span>))
cds2 &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">80</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">100</span>,<span class="dv">60</span>), <span class="kw">c</span>(<span class="dv">120</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">120</span>,<span class="op">-</span><span class="dv">55</span>), <span class="kw">c</span>(<span class="dv">80</span>,<span class="dv">0</span>))
polys &lt;-<span class="st"> </span><span class="kw">SpatialPolygonsDataFrame</span>(<span class="kw">SpatialPolygons</span>(<span class="kw">list</span>(<span class="kw">Polygons</span>(<span class="kw">list</span>(<span class="kw">Polygon</span>(cds1)), <span class="dv">1</span>), 
                                                       <span class="kw">Polygons</span>(<span class="kw">list</span>(<span class="kw">Polygon</span>(cds2)), <span class="dv">2</span>))),<span class="kw">data.frame</span>(<span class="dt">ID=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)))

## do extraction in abstract terms
(cn &lt;-<span class="st"> </span><span class="kw">cellnumbers</span>(r, polys))</code></pre></div>
<pre><code>## Warning: projections not the same 
##     x: +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0
## query: NA</code></pre>
<pre><code>## # A tibble: 63 x 2
##    object_ cell_
##      &lt;int&gt; &lt;dbl&gt;
##  1       1   326
##  2       1   327
##  3       1   328
##  4       1   329
##  5       1   330
##  6       1   331
##  7       1   332
##  8       1   333
##  9       1   334
## 10       1   335
## # ... with 53 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
## now perform extraction for real
## and pipe into grouping by polygon (object_) and value, and
## calculate class percentage from class counts per polygon
cn <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">v =</span> raster<span class="op">::</span><span class="kw">extract</span>(r, cell_)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(object_, v) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">count =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">v.pct =</span> count <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(count)) </code></pre></div>
<pre><code>## # A tibble: 18 x 4
## # Groups:   object_ [2]
##    object_     v count      v.pct
##      &lt;int&gt; &lt;dbl&gt; &lt;int&gt;      &lt;dbl&gt;
##  1       1     1     3 0.07894737
##  2       1     2     1 0.02631579
##  3       1     3     4 0.10526316
##  4       1     4     5 0.13157895
##  5       1     5     4 0.10526316
##  6       1     6     6 0.15789474
##  7       1     7     1 0.02631579
##  8       1     8     7 0.18421053
##  9       1     9     3 0.07894737
## 10       1    10     4 0.10526316
## 11       2     1     2 0.08000000
## 12       2     2     1 0.04000000
## 13       2     3     2 0.08000000
## 14       2     4     4 0.16000000
## 15       2     6     2 0.08000000
## 16       2     7     3 0.12000000
## 17       2     8     8 0.32000000
## 18       2     9     3 0.12000000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## here is the traditional code used in the stackoverflow example
<span class="co"># Extract raster values to polygons                             </span>
<span class="co">#( v &lt;- extract(r, polys) )</span>
<span class="co"># Get class counts for each polygon</span>
<span class="co">#v.counts &lt;- lapply(v,table)</span>
<span class="co"># Calculate class percentages for each polygon</span>
<span class="co">#( v.pct &lt;- lapply(v.counts, FUN=function(x){ x / sum(x) } ) )</span></code></pre></div>
</div>
<div id="extract-cell-numbers" class="section level1">
<h1>Extract cell numbers</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tabularaster)
<span class="kw">data</span>(<span class="st">&quot;ghrsst&quot;</span>)  ## a RasterLayer
<span class="kw">data</span>(<span class="st">&quot;sst_regions&quot;</span>) ## a polygon layer, contiguous with ghrsst

gcells &lt;-<span class="st"> </span><span class="kw">cellnumbers</span>(ghrsst, sst_regions) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">object_ =</span> <span class="kw">as.integer</span>(object_))

result &lt;-<span class="st"> </span>gcells <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">sst =</span> raster<span class="op">::</span><span class="kw">extract</span>(ghrsst, cell_)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(object_) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize_at</span>(<span class="kw">vars</span>(sst), <span class="kw">funs</span>(<span class="kw">mean</span>(., <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="kw">sd</span>(., <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), length))

<span class="kw">library</span>(spdplyr)
sst_regions &lt;-<span class="st"> </span>sst_regions <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inner_join</span>(result, <span class="kw">c</span>(<span class="st">&quot;ghrsst&quot;</span> =<span class="st"> &quot;object_&quot;</span>))

<span class="kw">plot</span>(ghrsst, <span class="dt">col =</span> <span class="kw">bpy.colors</span>(<span class="dv">30</span>), <span class="dt">addfun =</span> <span class="cf">function</span>() <span class="kw">plot</span>(sst_regions, <span class="dt">add =</span> <span class="ot">TRUE</span>), 
     <span class="dt">main =</span> <span class="st">&quot;SST data with simple regional polygon layer&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#library(sf)</span>
<span class="kw">plot</span>(sst_regions)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="extract-cells-from-rasters" class="section level1">
<h1>Extract cells from rasters</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tabularaster)
<span class="kw">library</span>(raster)
<span class="kw">library</span>(dplyr)
<span class="kw">data</span>(<span class="st">&quot;rastercano&quot;</span>)
<span class="kw">data</span>(<span class="st">&quot;polycano&quot;</span>)
cells &lt;-<span class="st"> </span><span class="kw">cellnumbers</span>(rastercano, polycano[<span class="dv">4</span><span class="op">:</span><span class="dv">5</span>, ])</code></pre></div>
<pre><code>## Warning: projections not the same 
##     x: NA
## query: NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cellnumbers</span>(rastercano, <span class="kw">as</span>(polycano[<span class="dv">4</span><span class="op">:</span><span class="dv">5</span>, ], <span class="st">&quot;SpatialLinesDataFrame&quot;</span>))</code></pre></div>
<pre><code>## Warning: projections not the same 
##     x: NA
## query: NA</code></pre>
<pre><code>## # A tibble: 235 x 2
##    object_ cell_
##      &lt;int&gt; &lt;dbl&gt;
##  1       1  1129
##  2       1  1190
##  3       1  1251
##  4       2     1
##  5       2     2
##  6       2     3
##  7       2     4
##  8       2     5
##  9       2     6
## 10       2     7
## # ... with 225 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cellnumbers</span>(rastercano, <span class="kw">as</span>(<span class="kw">as</span>(polycano[<span class="dv">4</span><span class="op">:</span><span class="dv">5</span>, ], <span class="st">&quot;SpatialLinesDataFrame&quot;</span>), <span class="st">&quot;SpatialPointsDataFrame&quot;</span>))</code></pre></div>
<pre><code>## Warning: projections not the same 
##     x: NA
## query: NA</code></pre>
<pre><code>## # A tibble: 331 x 2
##    object_ cell_
##      &lt;int&gt; &lt;dbl&gt;
##  1       1  1129
##  2       1  1129
##  3       1  1251
##  4       1  1251
##  5       1  1129
##  6       1  1098
##  7       1  1098
##  8       1  1098
##  9       1  1098
## 10       1  1037
## # ... with 321 more rows</code></pre>
<p>In the case of polygons, there’s an argument <code>weights</code> that can be used to get an approximate weighting for partial cell coverage.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">poly &lt;-<span class="st"> </span>sf<span class="op">::</span><span class="kw">st_sf</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">geometry =</span> sf<span class="op">::</span><span class="kw">st_sfc</span>(sf<span class="op">::</span><span class="kw">st_polygon</span>(<span class="kw">list</span>(
  <span class="kw">cbind</span>(<span class="kw">c</span>(<span class="fl">0.57</span>, <span class="fl">0.55</span>, <span class="fl">0.19</span>, <span class="fl">0.43</span>, <span class="fl">0.82</span>, <span class="fl">0.57</span>), 
        <span class="kw">c</span>(<span class="fl">0.22</span>, <span class="fl">0.24</span>, <span class="fl">0.46</span>, <span class="fl">0.77</span>, <span class="fl">0.56</span>, <span class="fl">0.22</span>))))))




xweight &lt;-<span class="st"> </span><span class="kw">cellnumbers</span>(rastercano, poly, <span class="dt">weights =</span> <span class="ot">TRUE</span>)

dgrid &lt;-<span class="st"> </span><span class="kw">setValues</span>(rastercano, <span class="ot">NA_real_</span>)
dgrid[xweight<span class="op">$</span>cell_] &lt;-<span class="st"> </span>xweight<span class="op">$</span>weight_
<span class="kw">plot</span>(dgrid, <span class="dt">main =</span> <span class="st">&quot;cell weights based on partial overlap&quot;</span>, <span class="dt">col =</span> viridis<span class="op">::</span><span class="kw">viridis</span>(<span class="dv">9</span>), 
     <span class="dt">addfun =</span> <span class="cf">function</span>() <span class="kw">polygon</span>(poly<span class="op">$</span>geometry[[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>)]]))</code></pre></div>
</div>
<div id="extract-values-or-cell-numbers-with-sf-object" class="section level1">
<h1>Extract values or cell numbers with sf object</h1>
<p>It’s an unfortunate symptom of fragmentation in the R spatial tools that two of the best and most highly used packages <code>raster</code> and <code>sf</code> have no formal way to be used together.</p>
<p>Here we use the <code>extent</code> capability of <code>spex</code>, and the tabularaster tools <code>extract</code> and <code>cellnumbers</code> to build a raster from an <code>sf</code> layer.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sf)

poly &lt;-<span class="st"> </span><span class="kw">read_sf</span>(<span class="kw">system.file</span>(<span class="st">&quot;shape/nc.shp&quot;</span>, <span class="dt">package=</span><span class="st">&quot;sf&quot;</span>))
<span class="kw">library</span>(spex)
<span class="kw">extent</span>(poly)
<span class="kw">spex</span>(poly)
## we can't do this
<span class="kw">try</span>(grid &lt;-<span class="st">  </span><span class="kw">raster</span>(poly))

## but we can do 

(grid &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">spex</span>(poly), <span class="dt">nrow =</span> <span class="dv">100</span>, <span class="dt">ncol =</span> <span class="dv">140</span>))

## index the raster with the sf layer
(cn &lt;-<span class="st"> </span><span class="kw">cellnumbers</span>(grid, poly))

grid[cn<span class="op">$</span>cell_] &lt;-<span class="st"> </span>cn<span class="op">$</span>object_

## we slasterized it (slow rasterize)
<span class="kw">plot</span>(grid)</code></pre></div>
<p>That’s nice, since we can actually use extract with the cell numbers, rather than the sf object. This is preferable for repeated use of the extraction, e.g. for time series extraction where we need to visit each time step iteratively. (Raster is already index-optimized for multi-layers raster objects).</p>
<p>Now use <code>fasterize</code> to generate the grid, and use cellnumbers to extract.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## fasterize it
<span class="kw">library</span>(fasterize)
<span class="co">#poly$object_ &lt;- as.integer(seq_len(nrow(poly)))</span>
fgrid &lt;-<span class="st"> </span><span class="kw">fasterize</span>(poly, grid, <span class="dt">field =</span> <span class="st">&quot;AREA&quot;</span>)
scl &lt;-<span class="st"> </span><span class="cf">function</span>(x) {rg &lt;-<span class="st"> </span><span class="kw">range</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>); (x   <span class="op">-</span><span class="st"> </span>rg[<span class="dv">1</span>])<span class="op">/</span><span class="kw">diff</span>(rg)}
<span class="kw">plot</span>(<span class="kw">xyFromCell</span>(grid, cn<span class="op">$</span>cell_), <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">cex =</span> <span class="fl">0.4</span>, <span class="dt">col =</span> <span class="kw">bpy.colors</span>(<span class="dv">26</span>)[<span class="kw">scl</span>(raster<span class="op">::</span><span class="kw">extract</span>(fgrid, cn<span class="op">$</span>cell_)) <span class="op">*</span><span class="st"> </span><span class="dv">25</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>])</code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
